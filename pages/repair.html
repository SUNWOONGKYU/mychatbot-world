<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë´‡ íƒìƒ‰ ë° ì—°ê²° - My Chatbot World</title>
    <style>
        body {
            background-color: #111;
            color: white;
            font-family: sans-serif;
            padding: 20px;
            text-align: center;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            background: #222;
            border-radius: 8px;
            overflow: hidden;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }

        th {
            background: #333;
            color: #aaa;
        }

        .btn {
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-connect {
            background: #10b981;
            color: white;
        }

        .btn-refresh {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .status-ok {
            color: #10b981;
        }

        .status-lost {
            color: #f59e0b;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” ë‚´ ì±—ë´‡ ì°¾ê¸° ë° ì—°ê²°</h1>
        <p>ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ëª¨ë“  ì±—ë´‡ ë°ì´í„°ë¥¼ ì •ë°€ ê²€ì‚¬í•©ë‹ˆë‹¤.<br>ìƒì–´ë²„ë¦° ì¨ë‹ˆë´‡ì„ ì°¾ì•„ [ì—°ê²°] ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>

        <button class="btn btn-refresh" onclick="scanBots()">ğŸ”„ ë‹¤ì‹œ ìŠ¤ìº”í•˜ê¸°</button>

        <div id="resultArea">
            <table id="botTable">
                <thead>
                    <tr>
                        <th>ë´‡ ì´ë¦„</th>
                        <th>ID</th>
                        <th>í˜„ì¬ ì£¼ì¸ (OwnerId)</th>
                        <th>ìƒíƒœ</th>
                        <th>ì¡°ì¹˜</th>
                    </tr>
                </thead>
                <tbody id="botTableBody">
                    <!-- Bots will be listed here -->
                </tbody>
            </table>
            <div id="emptyMsg" style="display:none; padding:40px; color:#666;">
                ì €ì¥ëœ ì±—ë´‡ ë°ì´í„°ê°€ í•˜ë‚˜ë„ ì—†ìŠµë‹ˆë‹¤.
                <br>í˜¹ì‹œ ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ì…¨ë‚˜ìš”?
            </div>
        </div>

        <div style="margin-top:40px; border-top:1px solid #333; padding-top:20px;">
            <h3>ê·¸ë˜ë„ ì•ˆ ë³´ì¸ë‹¤ë©´?</h3>
            <button class="btn" style="background:#ec4899; color:white;" onclick="forceCreate()">âš ï¸ ì¨ë‹ˆë´‡(5ì¸ê²©) ë°ì´í„° ê°•ì œ
                ìƒì„±</button>
        </div>
    </div>

    <script>
        const CURRENT_USER_ID = 'admin'; // Target User

        function scanBots() {
            const tbody = document.getElementById('botTableBody');
            tbody.innerHTML = '';

            let bots = [];
            try {
                bots = JSON.parse(localStorage.getItem('mcw_bots') || '[]');
            } catch (e) {
                console.error(e);
            }

            if (bots.length === 0) {
                document.getElementById('emptyMsg').style.display = 'block';
                document.getElementById('botTable').style.display = 'none';
                return;
            }

            document.getElementById('emptyMsg').style.display = 'none';
            document.getElementById('botTable').style.display = 'table';

            bots.forEach(bot => {
                const tr = document.createElement('tr');
                const isLost = bot.ownerId !== CURRENT_USER_ID;
                const statusHtml = isLost
                    ? `<span class="status-lost">ì—°ê²° ëŠê¹€ (ì£¼ì¸: ${bot.ownerId || 'ì—†ìŒ'})</span>`
                    : `<span class="status-ok">ì •ìƒ ì—°ê²°ë¨</span>`;

                const actionHtml = isLost
                    ? `<button class="btn btn-connect" onclick="connectBot('${bot.id}')">ğŸ”— ë‚´ ê³„ì •ìœ¼ë¡œ ì—°ê²°</button>`
                    : `<span style="color:#666;">-</span>`;

                tr.innerHTML = `
                    <td style="font-weight:bold; color:white;">${bot.botName || 'ì´ë¦„ ì—†ìŒ'}</td>
                    <td style="font-size:0.8rem; color:#888;">${bot.id}</td>
                    <td>${bot.ownerId || '<span style="color:red;">NULL</span>'}</td>
                    <td>${statusHtml}</td>
                    <td>${actionHtml}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function connectBot(botId) {
            if (!confirm('ì´ ì±—ë´‡ì„ ë‚´ ê³„ì •(Master Admin)ìœ¼ë¡œ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            let bots = JSON.parse(localStorage.getItem('mcw_bots') || '[]');
            const idx = bots.findIndex(b => b.id === botId);
            if (idx >= 0) {
                bots[idx].ownerId = CURRENT_USER_ID;
                localStorage.setItem('mcw_bots', JSON.stringify(bots));
                alert('ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤! ëŒ€ì‹œë³´ë“œì—ì„œ í™•ì¸í•˜ì„¸ìš”.');
                scanBots(); // Re-scan
            }
        }

        function forceCreate() {
            if (!confirm('ì •ë§ ë³´ì´ì§€ ì•Šì•„ ìƒˆë¡œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            // ... (Simple creation logic if needed)
            const SunnyBotData = {
                id: 'sunny-bot-sample', // Keep ID consistent
                botName: 'ì¨ë‹ˆë´‡ (5ì¸ì˜ ìì•„ í†µí•©í˜•)',
                botDesc: '5ê°€ì§€ í˜ë¥´ì†Œë‚˜ í†µí•© ë´‡',
                templateId: 'custom',
                username: 'sunny',
                ownerId: 'admin',
                created: Date.now(),
                personas: [], // (Full data would go here, simplified for this snippet)
                faqs: []
            };

            // Basic minimal data to make it visible
            let bots = JSON.parse(localStorage.getItem('mcw_bots') || '[]');
            bots.push(SunnyBotData);
            localStorage.setItem('mcw_bots', JSON.stringify(bots));
            alert('ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
            scanBots();
        }

        // Auto-run
        scanBots();
    </script>
</body>

</html>