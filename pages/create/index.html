<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나의 챗봇 생성하기 - My Chatbot World</title>
    <link rel="stylesheet" href="../../css/styles.css?v=13.1">
    <link rel="stylesheet" href="../../css/create.css?v=13.1">
</head>

<body class="dark-body">
    <nav class="navbar scrolled">
        <div class="container navbar-inner">
            <a href="/" class="navbar-logo"><span>My Chatbot World</span></a>
            <div class="navbar-cta">
                <a href="../home/index.html" class="btn btn-secondary btn-sm">마이 페이지</a>
            </div>
        </div>
    </nav>

    <main class="create-main">
        <div class="container-sm">
            <!-- Progress Bar (5 Steps) -->
            <div class="create-progress" id="progressBar">
                <div class="progress-steps">
                    <div class="progress-step horizontal active" data-step="1"><span>1</span>기본정보</div>
                    <div class="progress-step horizontal" data-step="2"><span>2</span>페르소나</div>
                    <div class="progress-step horizontal" data-step="3"><span>3</span>인터뷰</div>
                    <div class="progress-step horizontal" data-step="4"><span>4</span>분석</div>
                    <div class="progress-step horizontal" data-step="5"><span>5</span>완성</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- ===== Part 1: 봇 생성 (5분 내) ===== -->

            <!-- Step 1: 봇 기본정보 -->
            <div class="create-step" id="step1">
                <h2 class="step-title">챗봇의 기본 정보를 입력하세요</h2>
                <p class="step-desc">🎤 옆 마이크를 누르면 음성으로 입력됩니다. 직접 텍스트로 입력해도 됩니다.</p>
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">챗봇 이름 *</label>
                        <div class="input-with-mic">
                            <input type="text" class="form-input" id="botName"
                                placeholder="예: 홍길동, 김변호사, 박의원, 최셰프" maxlength="30">
                            <button type="button" class="mic-btn" onclick="voiceToField('botName')" title="음성 입력">🎤</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">한 줄 소개</label>
                        <div class="input-with-mic">
                            <input type="text" class="form-input" id="botDesc"
                                placeholder="예: 나를 대신해 24시간 소통하는 AI 챗봇" maxlength="100">
                            <button type="button" class="mic-btn" onclick="voiceToField('botDesc')" title="음성 입력">🎤</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">사용자명 (URL용)</label>
                        <div class="input-with-mic">
                            <div class="input-with-prefix" style="flex:1">
                                <span class="input-prefix">mychatbot.world/bot/</span>
                                <input type="text" class="form-input" id="botUsername" placeholder="my-bot" maxlength="20"
                                    pattern="[a-z0-9-]+">
                            </div>
                            <button type="button" class="mic-btn" onclick="voiceToField('botUsername')" title="음성 입력">🎤</button>
                        </div>
                        <small style="color: rgba(255,255,255,0.4); font-size: 0.75rem;">음성 입력 시 한글은 자동으로 영문 변환됩니다</small>
                    </div>
                    <button class="btn btn-primary btn-lg" style="width:100%" onclick="goToStep(2)">
                        다음: 페르소나 설정 →
                    </button>
                </div>
            </div>

            <!-- Step 2: 대표 페르소나 설정 -->
            <div class="create-step hidden" id="step2">
                <h2 class="step-title">대표 페르소나를 설정하세요</h2>
                <p class="step-desc">🎤 마이크 버튼으로 음성 입력 또는 직접 텍스트 입력이 가능합니다.<br>페르소나는 총 9개까지 추가할 수 있으며, 마이페이지에서 별도로 설정합니다.</p>

                <div class="persona-type-badge badge-avatar">대표 페르소나를 설정하세요</div>
                <div id="avatarPersonaList" class="persona-list"></div>

                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(1)">← 이전</button>
                    <button class="btn btn-primary" onclick="goToStep(3)">다음: 인터뷰 →</button>
                </div>
            </div>

            <!-- Step 3: 인터뷰 -->
            <div class="create-step hidden" id="step3">
                <h2 class="step-title">AI에게 당신을 소개해주세요</h2>
                <p class="step-desc">3분간 자유롭게 말하거나 텍스트로 입력해주세요</p>

                <div class="input-mode-tabs">
                    <button class="tab-btn active" onclick="switchInputMode('voice')">🎤 음성 입력</button>
                    <button class="tab-btn" onclick="switchInputMode('text')">⌨️ 텍스트 입력</button>
                </div>

                <!-- Voice Input -->
                <div class="voice-input-area" id="voiceInput">
                    <div class="voice-circle" id="voiceCircle" onclick="toggleRecording()">
                        <div class="voice-icon" id="voiceIcon">🎤</div>
                    </div>
                    <div class="voice-timer" id="voiceTimer">3:00</div>
                    <p class="voice-hint" id="voiceHint">마이크를 탭하여 녹음을 시작하세요</p>
                    <div class="voice-guide">
                        <h4>이런 내용을 말해주세요:</h4>
                        <ul id="voiceGuideList">
                            <li>자기소개와 업무 소개</li>
                            <li>고객이 자주 묻는 질문과 답변</li>
                            <li>전문 분야와 강점</li>
                            <li>원하는 대화 스타일</li>
                        </ul>
                    </div>
                </div>

                <!-- Text Input -->
                <div class="text-input-area hidden" id="textInput">
                    <textarea class="form-input form-textarea" id="textContent" rows="10"
                        placeholder="자기소개, 주요 업무, 자주 받는 질문과 답변을 자유롭게 작성해주세요..."></textarea>
                    <p class="char-count"><span id="charCount">0</span>/2000</p>
                </div>

                <div class="voice-transcript hidden" id="transcriptArea">
                    <h4>녹음 내용:</h4>
                    <p id="transcriptText"></p>
                </div>

                <button class="btn btn-primary btn-lg" style="width:100%; margin-top:1.5rem" onclick="analyzeInput()">
                    AI 분석 시작 →
                </button>
            </div>

            <!-- Step 4: AI 분석 -->
            <div class="create-step hidden" id="step4">
                <h2 class="step-title">AI가 분석 중입니다...</h2>
                <div class="analysis-animation" id="analysisAnimation">
                    <div class="analysis-spinner">
                        <div class="spinner spinner-primary" style="width:48px;height:48px;border-width:4px"></div>
                    </div>
                    <div class="analysis-steps" id="analysisSteps">
                        <div class="analysis-step">🔍 입력 데이터 분석 중...</div>
                        <div class="analysis-step">🧠 페르소나별 성격/어조 추출 중...</div>
                        <div class="analysis-step">💬 인사말 생성 중...</div>
                        <div class="analysis-step">❓ FAQ 자동 생성 중...</div>
                    </div>
                </div>
                <div class="analysis-result hidden" id="analysisResult">
                    <h2 class="step-title">챗봇이 탄생했습니다!</h2>
                    <div class="result-preview" id="resultPreview"></div>

                    <!-- 음성 선택 -->
                    <div class="voice-pick" id="voicePick">
                        <h3 class="voice-pick-title">챗봇 목소리를 선택하세요</h3>
                        <div class="voice-pick-grid" id="voicePickGrid">
                            <label class="voice-pick-card active" data-voice="fable">
                                <input type="radio" name="botVoice" value="fable" checked>
                                <span class="voice-pick-name">Fable</span>
                                <span class="voice-pick-desc">👨 남성 · 부드러운</span>
                            </label>
                            <label class="voice-pick-card" data-voice="nova">
                                <input type="radio" name="botVoice" value="nova">
                                <span class="voice-pick-name">Nova</span>
                                <span class="voice-pick-desc">👩 여성 · 밝고 친근한</span>
                            </label>
                            <label class="voice-pick-card" data-voice="shimmer">
                                <input type="radio" name="botVoice" value="shimmer">
                                <span class="voice-pick-name">Shimmer</span>
                                <span class="voice-pick-desc">👩 여성 · 따뜻한</span>
                            </label>
                            <label class="voice-pick-card" data-voice="alloy">
                                <input type="radio" name="botVoice" value="alloy">
                                <span class="voice-pick-name">Alloy</span>
                                <span class="voice-pick-desc">⚧ 중성 · 균형잡힌</span>
                            </label>
                            <label class="voice-pick-card" data-voice="echo">
                                <input type="radio" name="botVoice" value="echo">
                                <span class="voice-pick-name">Echo</span>
                                <span class="voice-pick-desc">👨 남성 · 차분한</span>
                            </label>
                            <label class="voice-pick-card" data-voice="onyx">
                                <input type="radio" name="botVoice" value="onyx">
                                <span class="voice-pick-name">Onyx</span>
                                <span class="voice-pick-desc">👨 남성 · 깊고 낮은</span>
                            </label>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="previewVoice()" id="voicePreviewBtn">
                            미리듣기
                        </button>
                    </div>

                    <button class="btn btn-primary btn-xl" style="width:100%; margin-top:1.5rem"
                        onclick="completeCreation()">
                        챗봇 생성하기
                    </button>
                </div>
            </div>

            <!-- Step 5: 완성 -->
            <div class="create-step hidden" id="step5">
                <div class="complete-celebration">
                    <div class="complete-icon">🎉</div>
                    <h2 class="step-title">축하합니다! 챗봇이 생성되었습니다!</h2>
                    <div class="complete-info">
                        <div class="complete-url">
                            <label>챗봇 URL:</label>
                            <div class="url-copy-box">
                                <input type="text" id="botUrl" readonly>
                                <button class="btn btn-sm btn-primary" onclick="copyUrl()">복사</button>
                            </div>
                        </div>
                        <div class="complete-qr" id="qrCode"></div>
                        <p style="text-align:center; margin-top:0.5rem;">
                            <button class="btn btn-secondary btn-sm" onclick="downloadQR()">QR 코드 다운로드</button>
                        </p>
                    </div>
                    <div class="complete-actions">
                        <a href="#" id="chatLink" class="btn btn-primary btn-lg">챗봇과 대화하기</a>
                        <a href="../home/index.html" class="btn btn-secondary btn-lg">마이 페이지로 가기</a>
                    </div>
                </div>

                <p class="complete-next-hint">마이페이지에서 지식베이스, 스킬, 챗봇 스쿨을 관리할 수 있습니다.</p>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../js/app.js?v=15.1"></script>
    <script src="../../js/kb-manager.js?v=15.1"></script>
    <script src="../../js/create.js?v=15.1"></script>
</body>

</html>
