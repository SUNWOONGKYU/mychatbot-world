<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>API Key Debugger</title>
    <style>
        body {
            background: #111;
            color: #fff;
            font-family: monospace;
            padding: 2rem;
        }

        .box {
            border: 1px solid #444;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
        }

        .success {
            color: #4f4;
        }

        .error {
            color: #f44;
        }

        .warn {
            color: #fb4;
        }
    </style>
</head>

<body>
    <h1>üîë API Key Debugger</h1>

    <div class="box">
        <h3>1. Config File Status</h3>
        <div id="configStatus">Loading...</div>
    </div>

    <div class="box">
        <h3>2. Secrets File Status</h3>
        <div id="secretsStatus">Loading...</div>
    </div>

    <div class="box">
        <h3>3. LocalStorage Status</h3>
        <div id="storageStatus">Loading...</div>
    </div>

    <div class="box">
        <h3>4. Resolved Key for Chat</h3>
        <div id="finalKey">Calculating...</div>
    </div>

    <button onclick="clearStorage()"
        style="padding: 10px 20px; background: #c33; color: white; border: none; border-radius: 4px; cursor: pointer;">
        üóëÔ∏è Force Clear LocalStorage & Reload
    </button>

    <!-- Load Scripts -->
    <script src="js/config.js?v=debug_1"></script>
    <script src="js/secrets.js?v=debug_1"></script>

    <script>
        function check() {
            // 1. Config
            const configDiv = document.getElementById('configStatus');
            if (typeof CONFIG !== 'undefined' && CONFIG.OPENROUTER_API_KEY) {
                configDiv.innerHTML = `<span class="success">‚úÖ Loaded from js/config.js</span><br>Key: ${mask(CONFIG.OPENROUTER_API_KEY)}`;
            } else {
                configDiv.innerHTML = `<span class="error">‚ùå CONFIG object not found or empty.</span>`;
            }

            // 2. Secrets
            const secretsDiv = document.getElementById('secretsStatus');
            if (typeof MCW_SECRETS !== 'undefined' && MCW_SECRETS.OPENROUTER_API_KEY) {
                secretsDiv.innerHTML = `<span class="success">‚úÖ Loaded from js/secrets.js</span><br>Key: ${mask(MCW_SECRETS.OPENROUTER_API_KEY)}`;
            } else {
                secretsDiv.innerHTML = `<span class="error">‚ùå MCW_SECRETS object not found or empty.</span>`;
            }

            // 3. Storage
            const storageDiv = document.getElementById('storageStatus');
            const stored = localStorage.getItem('mcw_openrouter_key');
            if (stored) {
                if (stored.includes('sk-or-v1-6a0b')) {
                    storageDiv.innerHTML = `<span class="error">‚ùå COMPROMISED KEY FOUND IN STORAGE!</span><br>Key: ${mask(stored)}`;
                } else {
                    storageDiv.innerHTML = `<span class="warn">‚ö†Ô∏è Found in LocalStorage (Should match Config)</span><br>Key: ${mask(stored)}`;
                }
            } else {
                storageDiv.innerHTML = `<span class="success">gw Clean (No key in storage)</span>`;
            }

            // 4. Final
            const finalDiv = document.getElementById('finalKey');
            let finalKey = (typeof MCW_SECRETS !== 'undefined') ? MCW_SECRETS.OPENROUTER_API_KEY : null;
            if (!finalKey && typeof CONFIG !== 'undefined') finalKey = CONFIG.OPENROUTER_API_KEY;

            if (finalKey) {
                if (finalKey.includes('sk-or-v1-6a0b')) {
                    finalDiv.innerHTML = `<h2 class="error">‚õî STOP! Using Compromised Key</h2>`;
                } else {
                    finalDiv.innerHTML = `<h2 class="success">üöÄ READY! Using Valid Key</h2><p>${mask(finalKey)}</p>`;
                }
            } else {
                finalDiv.innerHTML = `<h2 class="error">‚ùå NO KEY FOUND</h2>`;
            }
        }

        function mask(k) {
            if (!k) return "null";
            if (k.length < 10) return k;
            return k.substring(0, 15) + "..." + k.substring(k.length - 4);
        }

        function clearStorage() {
            localStorage.removeItem('mcw_openrouter_key');
            alert('Storage Cleared!');
            location.reload();
        }

        check();
    </script>
</body>

</html>